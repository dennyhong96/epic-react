(this["webpackJsonpreact-hooks"]=this["webpackJsonpreact-hooks"]||[]).push([[38],{186:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(1),o=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),a=t;return e&&(a="function"===typeof e?e(t):l(l({},t),e)),a},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),d=p(a),h=n,f=d["".concat(i,".").concat(h)]||d[h]||u[h]||r;return a?o.a.createElement(f,l(l({ref:t},s),{},{components:a})):o.a.createElement(f,l({ref:t},s))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"===typeof e||n){var r=a.length,i=new Array(r);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"===typeof e?e:n,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"},197:function(e,t,a){"use strict";a.r(t),a.d(t,"readingTime",(function(){return i})),a.d(t,"default",(function(){return c})),a.d(t,"tableOfContents",(function(){return s})),a.d(t,"frontMatter",(function(){return p}));var n=a(42),o=(a(1),a(186)),r=["components"],i={text:"4 min read",minutes:3.3,time:198e3,words:660},l={};function c(e){var t=e.components,a=Object(n.a)(e,r);return Object(o.a)("wrapper",Object.assign({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.a)("h1",{id:"useeffect-persistent-state"},"useEffect: persistent state"),Object(o.a)("h2",{id:"-your-notes"},"\ud83d\udcdd Your Notes"),Object(o.a)("p",null,"Elaborate on your learnings here in ",Object(o.a)("inlineCode",{parentName:"p"},"src/exercise/02.md")),Object(o.a)("h2",{id:"background"},"Background"),Object(o.a)("p",null,Object(o.a)("inlineCode",{parentName:"p"},"React.useEffect")," is a built-in hook that allows you to run some custom code\nafter React renders (and re-renders) your component to the DOM. It accepts a\ncallback function which React will call after the DOM has been updated:"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-javascript","data-language":"javascript","data-highlighted-line-numbers":"",dangerouslySetInnerHTML:{__html:'React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// your side-effect code here.</span>\n  <span class="token comment">// this is where you can make HTTP requests or interact with browser APIs.</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n'}})),Object(o.a)("p",null,"Feel free to take a look at ",Object(o.a)("inlineCode",{parentName:"p"},"src/examples/hook-flow.png")," if you\u2019re interested in\nthe timing of when your functions are run. This will make more sense after\nfinishing the exercises/extra credit/instruction."),Object(o.a)("h2",{id:"exercise"},"Exercise"),Object(o.a)("p",null,"Production deploys:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",{parentName:"li",href:"https://react-hooks.netlify.app/isolated/exercise/02.js"},"Exercise")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",{parentName:"li",href:"https://react-hooks.netlify.app/isolated/final/02.js"},"Final"))),Object(o.a)("p",null,"In this exercise, we\u2019re going to enhance our ",Object(o.a)("inlineCode",{parentName:"p"},"<Greeting />")," component to get its\ninitial state value from localStorage (if available) and keep localStorage\nupdated as the ",Object(o.a)("inlineCode",{parentName:"p"},"name")," is updated."),Object(o.a)("h2",{id:"extra-credit"},"Extra Credit"),Object(o.a)("h3",{id:"1--lazy-state-initialization"},"1. \ud83d\udcaf lazy state initialization"),Object(o.a)("p",null,Object(o.a)("a",{parentName:"p",href:"https://react-hooks.netlify.app/isolated/final/02.extra-1.js"},"Production deploy")),Object(o.a)("p",null,"Right now, every time our component function is run, our function reads from\nlocalStorage. This is problematic because it could be a performance bottleneck\n(reading from localStorage can be slow). And what\u2019s more we only actually need\nto know the value from localStorage the first time this component is rendered!\nSo the additional reads are wasted effort."),Object(o.a)("p",null,"To avoid this problem, React\u2019s useState hook allows you to pass a function\ninstead of the actual value, and then it will only call that function to get the\nstate value when the component is rendered the first time. So you can go from\nthis: ",Object(o.a)("inlineCode",{parentName:"p"},"React.useState(someExpensiveComputation())")," To this:\n",Object(o.a)("inlineCode",{parentName:"p"},"React.useState(() => someExpensiveComputation())")),Object(o.a)("p",null,"And the ",Object(o.a)("inlineCode",{parentName:"p"},"someExpensiveComputation")," function will only be called when it\u2019s\nneeded!"),Object(o.a)("p",null,"Make the ",Object(o.a)("inlineCode",{parentName:"p"},"React.useState")," call use lazy initialization to avoid a performance\nbottleneck of reading into localStorage on every render."),Object(o.a)("blockquote",null,Object(o.a)("p",{parentName:"blockquote"},"Learn more about\n",Object(o.a)("a",{parentName:"p",href:"https://kentcdodds.com/blog/use-state-lazy-initialization-and-function-updates"},"lazy state initialization"))),Object(o.a)("h3",{id:"2--effect-dependencies"},"2. \ud83d\udcaf effect dependencies"),Object(o.a)("p",null,Object(o.a)("a",{parentName:"p",href:"https://react-hooks.netlify.app/isolated/final/02.extra-2.js"},"Production deploy")),Object(o.a)("p",null,"The callback we\u2019re passing to ",Object(o.a)("inlineCode",{parentName:"p"},"React.useEffect")," is called after ",Object(o.a)("em",{parentName:"p"},"every")," render\nof our component (including re-renders). This is exactly what we want because we\nwant to make sure that the ",Object(o.a)("inlineCode",{parentName:"p"},"name")," is saved into localStorage whenever it\nchanges, but there are various reasons a component can be re-rendered (for\nexample, when a parent component in the application tree gets re-rendered)."),Object(o.a)("p",null,"Really, we ",Object(o.a)("em",{parentName:"p"},"only")," want localStorage to get updated when the ",Object(o.a)("inlineCode",{parentName:"p"},"name")," state\nactually changes. It doesn\u2019t need to re-run any other time. Luckily for us,\n",Object(o.a)("inlineCode",{parentName:"p"},"React.useEffect"),' allows you to pass a second argument called the "dependency\narray" which signals to React that your effect callback function should be\ncalled when (and only when) those dependencies change. So we can use this to\navoid doing unnecessary work!'),Object(o.a)("p",null,"Add a dependencies array for ",Object(o.a)("inlineCode",{parentName:"p"},"React.useEffect")," to avoid the callback being\ncalled too frequently."),Object(o.a)("h3",{id:"3--custom-hook"},"3. \ud83d\udcaf custom hook"),Object(o.a)("p",null,Object(o.a)("a",{parentName:"p",href:"https://react-hooks.netlify.app/isolated/final/02.extra-3.js"},"Production deploy")),Object(o.a)("p",null,"The best part of hooks is that if you find a bit of logic inside your component\nfunction that you think would be useful elsewhere, you can put that in another\nfunction and call it from the components that need it (just like regular\nJavaScript). These functions you create are called \u201ccustom hooks\u201d."),Object(o.a)("p",null,"Create a custom hook called ",Object(o.a)("inlineCode",{parentName:"p"},"useLocalStorageState")," for reusability of all this\nlogic."),Object(o.a)("h3",{id:"4--flexible-localstorage-hook"},"4. \ud83d\udcaf flexible localStorage hook"),Object(o.a)("p",null,Object(o.a)("a",{parentName:"p",href:"https://react-hooks.netlify.app/isolated/final/02.extra-4.js"},"Production deploy")),Object(o.a)("p",null,"Take your custom ",Object(o.a)("inlineCode",{parentName:"p"},"useLocalStorageState")," hook and make it generic enough to\nsupport any data type (remember, you have to serialize objects to strings\u2026 use\n",Object(o.a)("inlineCode",{parentName:"p"},"JSON.stringify")," and ",Object(o.a)("inlineCode",{parentName:"p"},"JSON.parse"),"). Go wild with this!"),Object(o.a)("h2",{id:"notes"},"Notes"),Object(o.a)("p",null,"If you\u2019d like to learn more about when different hooks are called and the order\nin which they\u2019re called, then open up ",Object(o.a)("inlineCode",{parentName:"p"},"src/examples/hook-flow.png")," and\n",Object(o.a)("inlineCode",{parentName:"p"},"src/examples/hook-flow.js"),". Play around with that a bit and hopefully that will\nhelp solidify this for you. Note that understanding this isn\u2019t absolutely\nnecessary for you to understand hooks, but it ",Object(o.a)("em",{parentName:"p"},"will")," help you in some situations\nso it\u2019s useful to understand."),Object(o.a)("blockquote",null,Object(o.a)("p",{parentName:"blockquote"},"PLEASE NOTE: there was a subtle change in the order of cleanup functions\ngetting called in React 17:\n",Object(o.a)("a",{parentName:"p",href:"https://github.com/kentcdodds/react-hooks/issues/90"},"https://github.com/kentcdodds/react-hooks/issues/90"))),Object(o.a)("h2",{id:"-feedback"},"\ud83e\udd89 Feedback"),Object(o.a)("p",null,"Fill out\n",Object(o.a)("a",{parentName:"p",href:"https://ws.kcd.im/?ws=React%20Hooks%20%F0%9F%8E%A3&e=02%3A%20useEffect%3A%20persistent%20state&em="},"the feedback form"),"."))}c.isMDXComponent=!0;var s=function(){return[{id:"-your-notes",level:2,title:"\ud83d\udcdd Your Notes",children:[]},{id:"background",level:2,title:"Background",children:[]},{id:"exercise",level:2,title:"Exercise",children:[]},{id:"extra-credit",level:2,title:"Extra Credit",children:[{id:"1--lazy-state-initialization",level:3,title:"1. \ud83d\udcaf lazy state initialization",children:[]},{id:"2--effect-dependencies",level:3,title:"2. \ud83d\udcaf effect dependencies",children:[]},{id:"3--custom-hook",level:3,title:"3. \ud83d\udcaf custom hook",children:[]},{id:"4--flexible-localstorage-hook",level:3,title:"4. \ud83d\udcaf flexible localStorage hook",children:[]}]},{id:"notes",level:2,title:"Notes",children:[]},{id:"-feedback",level:2,title:"\ud83e\udd89 Feedback",children:[]}]},p={}}}]);
//# sourceMappingURL=38.356bfffd.chunk.js.map